---
title: Dashboard
format: 
  dashboard:
    orientation: rows
    scrolling: true
    include-in-header:
      text: |
            <script src="lshtm.js"></script>
    css: "styles.css"
    fig-format: svg
toc: false
execute: 
  echo: false
  freeze: auto
  cache: false
---

<!-- Setup, no output -->

```{r setup, include=FALSE}
## Packages
pacman::p_load(here, 
               purrr, readr, dplyr, forcats, stringr,
               bslib, bsicons, 
               ggplot2, plotly, shiny, patchwork)

## Load data dictionary
datadict <- readRDS(here("data/data-dictionary.RDS"))
## Load log
log <- readRDS(here("data/public/log.RDS"))
## Load Data RDS
data <- readRDS(here("data/public/summary-stats.RDS"))

options <- c("sex", "age", "governorate", "role", "children_feeding")
# Generate all non-empty combinations
strata <- unlist(
  #lapply(1:length(options), function(k) {
  lapply(1:2, function(k) {
    combn(sort(options), k, FUN = function(x) paste(x, collapse = "-"))
  })
)
# Add 'Overall' as default/fallback
strata <- c("overall", strata)
meta_params <- list("organisation" = names(data))

## Source plotting scripts
source(here("R", "data-pipeline", "0-data-dictionary.R"))
source(here("R", "data-analysis/generate_key_insights.R"))
source(here("R", "data-analysis/plot_participants_over_time.R"))
source(here("R", "data-analysis/plot_current_summary_stats.R"))
source(here("R", "data-analysis/plot_time_series_statistics.R"))
source(here("R", "data-analysis/plot_bmicategory_proportions_time_series.R"))
source(here("R", "data-analysis/ggplot_theme.R"))
```

<!-- Global sidebar -->

# {.sidebar}

This project provides real-time information on the nutritional status of humanitarian staff in Gaza. 
Our aim is to inform humanitarian decision-making, advocacy, and diplomatic action to improve the lives of the affected population. 

::: {.callout-note collapse="true" title="About the project"}
In this study we are monitoring nutritional status by tracking changes in weight and BMI. 
This information system is set up by organisations providing humanitarian services inside the Gaza Strip, with the technical and scientific support of the London School of Hygiene and Tropical Medicine (LSHTM). 
All participation is entirely voluntary. 
_Results are preliminary: please interpret with caution._

**[Read more](./about)**

:::

::: {.callout-caution collapse="true" title="Join us"}
We are actively seeking participants to support the project, and welcome new collaborations with humanitarian organisations. We invite all humanitarian staff to participate.

- [**Get involved**](./contact)
:::

::: {.callout-tip collapse="false" title="Stratify data"}
<!-- Add data filter-->
<div class="lshtm_widget_filter">
  <div class="filter_content">
  <fieldset>
    <!--<legend>Stratify data by</legend>-->
    <label>
      <input type="checkbox" name="data_filter" value="sex">
      Sex
    </label><br>
    <label>
      <input type="checkbox" name="data_filter" value="age">
      Age
    </label><br>
    <label>
      <input type="checkbox" name="data_filter" value="governorate">
      Location
    </label><br>
    <label>
      <input type="checkbox" name="data_filter" value="role">
      Staff role
    </label>
    <label>
      <input type="checkbox" name="data_filter" value="children_feeding">
      Dependent children
    </label><br>
  </fieldset>
</div>
</div>
:::

<details>
<summary>Updated</summary>
<p> Data: `r log$max_date` | Website: `r Sys.Date()`</p>
</details>


<!-- Dashboard pages -->

# All Participants

```{r}
meta_params$organisation <- "Overall"
```

{{< include _template-org.qmd >}}


<!-- # UN Relief and Works Agency -->

<!-- ```{r} -->
<!-- meta_params$organisation <- "UNRWA" -->
<!-- ``` -->

<!-- {{< include _template-org.qmd >}} -->


<!-- # Save the Children International -->

<!-- ```{r} -->
<!-- meta_params$organisation <- "Save the Children International" -->
<!-- ``` -->

<!-- {{< include _template-org.qmd >}} -->

