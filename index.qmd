---
title: ""
format: 
  html:
    include-in-header:
      text: |
            <script src="lshtm.js"></script>
    css: "styles.css"
    fig-format: svg
    page-layout: custom
    anchor-sections: true
    smooth-scroll: true
toc: false
execute: 
  echo: false
---

<!-- Setup, no output -->

```{r setup, include=FALSE}
## Packages
pacman::p_load(here, 
               purrr, readr, dplyr,
               bslib, bsicons, 
               ggplot2, plotly)

## Load data dictionary
datadict <- readRDS("data/data_dictionary.RDS")

## Load Data RDS
data <- readRDS("data/public/summary-stats.RDS")

options <- c("sex", "agegroup", "governorate", "role")
# Generate all non-empty combinations
strata <- unlist(
  #lapply(1:length(options), function(k) {
  lapply(1:2, function(k) {
    combn(sort(options), k, FUN = function(x) paste(x, collapse = "-"))
  })
)
# Add 'Overall' as default/fallback
strata <- c("Overall", strata)

params_meta <- list("organisation" = "all", # set to "all" by default: overwritten for each
               "strata" = strata)

## Source plotting scripts
source(here("R", "data-analysis/generate_key_insights.R"))
source(here("R", "data-analysis/recode_data_table.R"))
source(here("R", "data-analysis/plot_participants_over_time.R"))
source(here("R", "data-analysis/plot_current_summary_stats.R"))
source(here("R", "data-analysis/plot_time_series_statistics.R"))
source(here("R", "data-analysis/plot_bmicategory_proportions_time_series.R"))
source(here("R", "data-analysis/ggplot_theme.R"))
```

<!-- Global sidebar -->

:::: {.columns}

::: {.column width="25%"}

::: {.callout-note collapse="false" title="Dashboard"}
This project provides real-time information on the **nutritional status of humanitarian staff in Gaza**. Our aim is to inform humanitarian decision-making, advocacy, and diplomatic action to improve the lives of the affected population. We are developing this project during a rapidly changing situation: **please interpret results with caution**.

[**Read more**](./about){.btn .btn-outline-primary .btn role="button"} 
:::

::: {.callout-caution collapse="false" title="Join us"}
We are actively seeking participants to support the project, and welcome humanitarian staff to get in touch. 

[**Join us**](./contact){.btn .btn-outline-success .btn role="button"} 
:::

<!-- Add data filter
 - todo: change to pandoc format
 - todo: fill options automatically or wrap in function
-->
<div class="lshtm_widget_filter">
  <p><strong>Stratify data by</strong></p>
  <div class="filter_content">
  <fieldset>
    <!--<legend>Stratify data by</legend>-->
    <label>
      <input type="checkbox" name="data_filter" value="sex">
      Sex
    </label><br>
    <label>
      <input type="checkbox" name="data_filter" value="agegroup">
      Age
    </label><br>
    <label>
      <input type="checkbox" name="data_filter" value="governorate">
      Location
    </label><br>
    <label>
      <input type="checkbox" name="data_filter" value="role">
      Role
    </label>
  </fieldset>
</div>
</div>

:::


::: {.column width="75%"}

::: {.panel-tabset}

## **All participants**

```{r}
params_meta$organisation <- "all"
```

{{< include _organisation.qmd >}}


## **UNRWA**

```{r}
params_meta$organisation <- "UNRWA"
```

{{< include _organisation.qmd >}}


## **Save the Children International**

```{r}
params_meta$organisation <- "Save the Children International"
```

{{< include _organisation.qmd >}}


:::

:::

::::
