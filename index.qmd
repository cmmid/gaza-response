---
title: Dashboard
format: 
  dashboard:
    orientation: columns
    scrolling: false
    css: "styles.css"
    fig-format: svg
toc: false
execute: 
  echo: false
  freeze: auto
  cache: false
---

```{r setup, include=FALSE}
## Packages
pacman::p_load(here, 
               purrr, readr, dplyr, forcats, stringr,
               bslib, bsicons, 
               ggplot2, plotly, shiny, patchwork)
# Source plotting scripts
source(here("R", "data-pipeline", "0-data-dictionary.R"))
source(here("R", "data-analysis/generate_key_insights.R"))
source(here("R", "data-analysis/plot_participants_over_time.R"))
source(here("R", "data-analysis/plot_current_summary_stats.R"))
source(here("R", "data-analysis/plot_time_series_statistics.R"))
source(here("R", "data-analysis/plot_bmicategory_proportions_time_series.R"))
source(here("R", "data-analysis/ggplot_theme.R"))

# Load metadata
## Data dictionary
data_dictionary <- set_data_dictionary()
## Pipeline log
log <- readRDS(here("data/public/log.RDS"))
 
# Load data
summary <- list()
summary$tables <- readRDS(here("data", "public", "summary-tables.RDS"))
summary$data$latest_records <- readRDS(here("data", "public", "summary-cohort-all.RDS")) 
summary$data$daily_records <- readRDS(here("data", "public", "summary-cohort-daily.RDS"))
# recode labelling (convention: Upper-case variable name = pretty label name)
suppressWarnings(
  summary$data <- map(summary$data, 
                 ~ .x |> 
                   mutate(Strata = as_factor(strata),
                               Strata = fct_recode(Strata,
                                                   !!!data_dictionary$data_levels),
                               Stratum = as_factor(stratum),
                               Stratum = fct_recode(Stratum,
                                                    !!!data_dictionary$data_levels),
                               Variable = as_factor(variable),
                               Variable = fct_recode(Variable,
                                                    !!!data_dictionary$data_levels))
  )
)

meta_params <- list(organisation = NA, strata = NA)
```

<!--- MAIN PAGE FRAME -------------------------------------------------------->

<!-- Global sidebar -->

# {.sidebar}

This project provides real-time information on the nutritional status of humanitarian staff in Gaza. 
Our aim is to inform humanitarian decision-making, advocacy, and diplomatic action to improve the lives of the affected population. 

::: {.callout-note collapse="true" title="About the project"}
In this study we are monitoring nutritional status by tracking changes in weight and BMI. 
This information system is set up by organisations providing humanitarian services inside the Gaza Strip, with the technical and scientific support of the London School of Hygiene and Tropical Medicine (LSHTM). 
 All participation is entirely voluntary. 

_Results are preliminary: please interpret with caution._

[**Read more**](./about){.btn .btn-info .btn role="button"}

:::

::: {.callout-caution collapse="false" title="Join us"}
We are actively seeking participants to support the project, and welcome new collaborations with humanitarian organisations. 
We invite all humanitarian staff to participate.

[**Get involved**](./contact){.btn .btn-info .btn role="button"}
:::


<details>
<summary>Updated</summary>
<p> 
- Data: `r log$data_raw$max_date`
- Website: `r Sys.Date()`
</p>
</details>


<!-- TOP LEVEL TAB PAGES ------------------------------------------------->

# All Participants

```{r}
meta_params$organisation <- "Overall"
```

{{< include ./quarto/_template-org.qmd >}}


<!-- # UN Relief and Works Agency -->

<!-- ```{r} -->
<!-- meta_params$organisation <- "UNRWA" -->
<!-- ``` -->

<!-- {{< ./quarto/include _template-org.qmd >}} -->


<!-- # Save the Children International -->

<!-- ```{r} -->
<!-- meta_params$organisation <- "Save the Children International" -->
<!-- ``` -->

<!-- {{< ./quarto/include _template-org.qmd >}} -->

