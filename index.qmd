---
title: Dashboard
format: 
  dashboard:
    orientation: rows
    scrolling: true
    css: "styles.css"
    fig-format: svg
filters:
  - panel-accordion
execute: 
  echo: false
  freeze: false
  cache: false
---

```{r setup, include=FALSE}
## Packages
pacman::p_load(here, 
               purrr, readr, dplyr, forcats, stringr,
               bslib, bsicons, 
               ggplot2, scales, plotly, shiny)
# Source plotting scripts
source(here("R", "data-pipeline", "0-data-dictionary.R"))
source(here("R", "data-analysis/generate_key_insights.R"))
source(here("R", "data-analysis/plot_participants_over_time.R"))
source(here("R", "data-analysis/plot_bmi_categories.R"))
source(here("R", "data-analysis/plot_current_summary_stats.R"))
source(here("R", "data-analysis/plot_time_series_statistics.R"))
source(here("R", "data-analysis/plot_bmicategory_proportions_time_series.R"))
source(here("R", "data-analysis/ggplot_theme.R"))

# Load metadata
## Data dictionary
data_dictionary <- set_data_dictionary()
## Pipeline log
log <- readRDS(here("data/public/log.RDS"))
 
# Load data
summary <- list()
summary$tables <- readRDS(here("data", "public", "summary-tables.RDS"))
summary$data$latest <- readRDS(here("data", "public", "summary-latest.RDS")) 
summary$data$timeseries <- readRDS(here("data", "public", "summary-timeseries.RDS"))
# recode labelling (convention: Upper-case variable name = pretty label name)
suppressWarnings(
  summary$data <- map(summary$data, 
                 ~ .x |> 
                   mutate(Strata = fct_recode(strata,
                                               !!!data_dictionary$data_levels),
                          Stratum = fct_recode(stratum,
                                               !!!data_dictionary$data_levels),
                          Variable = fct_recode(variable,
                                                !!!data_dictionary$data_levels))
  )
)

meta_params <- list(organisation = NA, strata = NA)
```

<!--- MAIN PAGE FRAME -------------------------------------------------------->

<!-- Global sidebar -->

# {.sidebar}

This project provides real-time information on the nutritional status of humanitarian staff in Gaza. 
Our aim is to inform humanitarian decision-making, advocacy, and diplomatic action to improve the lives of the affected population. 

::: {.callout-caution collapse="false" title="Join us"}
We are actively seeking participants to support the project, and welcome new collaborations with humanitarian organisations. 
We invite all humanitarian staff to participate.

[**Get involved**](./contact){.btn .btn-info .btn role="button"}
:::

::: {.callout-note collapse="true" title="About the project"}
In this study we are monitoring nutritional status by tracking changes in weight and BMI. 
This information system is set up by organisations providing humanitarian services inside the Gaza Strip, with the technical and scientific support of the London School of Hygiene and Tropical Medicine (LSHTM).

_Results are preliminary: please interpret with caution._

[**Read more**](./about){.btn .btn-info .btn role="button"}

:::

::: {.callout-note collapse="true" title="About the data"}

Last updated:

- Data: `r log$data_raw$max_date`
- Website: `r Sys.Date()`

We publish aggregated summary statistics as publicly available data.

- Find the [public data](https://github.com/cmmid/gaza-response/tree/main/data/public)
- Read about [data collection](./about)
- Explore the [code](https://github.com/cmmid/gaza-response/)

This project is built and maintained collectively and for free by volunteers. 
We develop in the open, using R, Quarto, and Github.
All code is public and open source under an MIT license. 
**We welcome and encourage contributors.** 

- [Contribute](https://github.com/cmmid/gaza-response/discussions){.btn .btn-info .btn role="button"}

:::


<!-- TOP LEVEL TAB PAGES ------------------------------------------------->

# All Participants

```{r}
meta_params$organisation <- "Overall"
```

{{< include quarto/_organisation.qmd >}}

# UN Relief and Works Agency

```{r}
meta_params$organisation <- "UNRWA"
```

{{< include quarto/_organisation.qmd >}}

# Save the Children International

```{r}
meta_params$organisation <- "Save the Children International"
```

{{< include quarto/_organisation.qmd >}}
